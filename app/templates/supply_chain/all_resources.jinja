<script defer>
  const VIEW = {
    AVALIABLE_RESOURCES: 'avaliable-resources',
    DONATED_ITEMS: 'donated-items',
    DONATED_MONEY: 'donated-money',
    PENDING_REQUESTS: 'pending-requests',
    REQUEST_HISTORY: 'request-history' 
  }
  
  let hideAllItems = function () {
    for (let value in VIEW) {
      console.log(VIEW[value])
      let currElement = document.getElementById(VIEW[value]);
      if (currElement) {
        currElement.style['display'] = 'none';
      }
    }
  }

  let changeView = function (view) {
    if(typeof(VIEW, view)) {
      hideAllItems();
      console.log(view)
      let currElement = document.getElementById(view);
      if(currElement) {
        currElement.style['display'] = 'block';
      }
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    hideAllItems()
    changeView(VIEW.AVALIABLE_RESOURCES)
 }, false);

</script>

{% extends "base.jinja" %}

{% block title %}{{ _("Tracking and managing resources module") }}{% endblock %}


{% block content %}
<div class="container-fluid mt-4">
  <h1>{{ _("Tracking and managing resources module") }}</h1>
  <a href="{{ url_for('supply_chain.index') }}">
    <input type="button" class="btn btn-primary btn-lg" id="back-button" value="Back"> 
  </a>
  <input type="button" class="btn btn-primary btn-lg" id="donated-items-button" value="Avaliable resources" onclick="changeView(VIEW.AVALIABLE_RESOURCES)">
  <input type="button" class="btn btn-primary btn-lg" id="donated-items-button" value="Donated items" onclick="changeView(VIEW.DONATED_ITEMS)">
  <input type="button" class="btn btn-primary btn-lg" id="donated-money-button" value="Donated money" onclick="changeView(VIEW.DONATED_MONEY)">
  <input type="button" class="btn btn-primary btn-lg" id="pending-requests-button" value="Pending requests" onclick="changeView(VIEW.PENDING_REQUESTS)">
  <input type="button" class="btn btn-primary btn-lg" id="request-history-button" value="Completed requests" onclick="changeView(VIEW.REQUEST_HISTORY)">

  <h2>{{ _("All resources") }}</h2>
  <div>
    <form method="post">
      <label for="curr_charity_campaign">{{ _("Charity campaign") }}</label>
      <select name="curr_charity_campaign_id">
        {% if curr_charity_campaign is defined %}
          {% for charity_campaign in charity_campaigns %}
            {% if charity_campaign.id == curr_charity_campaign.id %} 
              <option selected value="{{charity_campaign.id}}">{{charity_campaign.name}}</option>
            {% else %}
              <option value="{{charity_campaign.id}}">{{charity_campaign.name}}</option>
            {% endif %}
          {% endfor %}
        {% else %}
          <option selected diabled hidden value="none">{{ _("Select charity campaign") }}</option>
          {% for charity_campaign in charity_campaigns %}
            <option value="{{charity_campaign.id}}">{{charity_campaign.name}}</option>
          {% endfor %}
        {% endif %}
      </select>
      <input type="submit" value="Show resources for charity campaign">
    </form>


      {% if organizations_with_resources is defined %}
        <table class="table table-hover" id="avaliable-resources">
          <tr>
            <th colspan="3">Avaliable resources</th>
          </tr>
          <tr>
            <td>Organization</td>
            <td>Item type</td>
            <td>Amount</td>
          </tr>
          {% for curr_resource in organizations_with_resources %}
          <tr>
            <td rowspan="{{curr_resource.item_stock}}|length">{{curr_resource.organization.organization_name}}</td>
            <td>
              <table>
                {% for curr_item_stock in curr_resource.item_stock %}
                <tr>
                  <td>{{curr_item_stock.type}}</td>
                </tr>
                {% endfor %}
              </table>
            </td>
            <td>
              <table>
                {% for curr_item_stock in curr_resource.item_stock %}
                <tr>
                  <td>{{curr_item_stock.amount}}</td>
                </tr>
                {% endfor %}
              </table>
            </td>
          </tr>
          {% endfor %}
        </table>

        <table class="table table-hover" id="donated-items">
          <tr>
            <th colspan="3">Donations - items</th>
          </tr>
          <tr>
            <td>Organization</td>
            <td>Donation type</td>
            <td>Donation amount</td>
          </tr>
          {% for curr_resource in organizations_with_resources %}
            {% if curr_resource.item_donations is defined and curr_resource.item_donations|length > 0 %}
            <tr>
              <td rowspan="{{curr_resource.item_donations}}|length">{{curr_resource.organization.organization_name}}</td>
              <td>
                <table>
                  {% for curr_item_donation in curr_resource.item_donations %}
                  <tr>
                    <td>{{curr_item_donation.type}}</td>
                  </tr>
                  {% endfor %}
                </table>
              </td>
              <td>
                <table>
                  {% for curr_item_donation in curr_resource.item_donations %}
                  <tr>
                    <td>{{curr_item_donation.amount}}</td>
                  </tr>
                  {% endfor %}
                </table>
              </td>
            </tr>
            {% endif %}
          {% endfor %}
        </table>

        <table class="table table-hover" id="donated-money">
          <tr>
            <th colspan="3">Donations - money</th>
          </tr>
          <tr>
            <td>Organization</td>
            <td>Donation type</td>
            <td>Donation amount</td>
          </tr>
          {% for curr_resource in organizations_with_resources %}
            {% if curr_resource.money_donations is defined and curr_resource.money_donations|length > 0 %}
            <tr>
              <td rowspan="{{curr_resource.money_donations}}|length">{{curr_resource.organization.organization_name}}</td>
              <td>
                <table>
                  {% for curr_money_donation in curr_resource.money_donations %}
                  <tr>
                    <td>{{curr_money_donation.donation_type}}</td>
                  </tr>
                  {% endfor %}
                </table>
              </td>
              <td>
                <table>
                    {% for curr_money_donation in curr_resource.money_donations %}
                    <tr>
                      <td>{{curr_money_donation.cashAmount}}</td>
                    </tr>
                    {% endfor %}
                </table>
              </td>
            </tr>
            {% endif %}
          {% endfor %}
        </table>

        <table class="table table-hover" id="pending-requests">
          <tr>
            <th colspan="3">{{ _("Pending") }}</th>
          </tr>
          <tr>
            <td>{{ _("Lp") }} </td>
            <td>{{ _("Name") }}</td>
            <td>{{ _("Status") }}</td>
            <td>{{ _("Affected") }}  </td>
            <td>{{ _("Address") }} </td>
            <td>{{ _("Needs") }}</td>
            <td>{{ _("Amount") }}</td>
          </tr>
          {% for curr_request in requests_for_charity_campaign %}
          {% if curr_request.status == request_status.PENDING %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ curr_request.name }}</td>
              <td>{{ curr_request.status }}</td>
              <td>
                <table class="table">
                  <tr>
                    <td>{{ _("First name:") }}</td>
                    <td>{{ curr_request.first_name }}</td>
                  </tr>
                  <tr>
                    <td>{{ _("Last name") }}  </td>
                    <td> {{ curr_request.last_name }} </td>
                  </tr>
                </table>
              </td>
              <td>
                <table>
                  <tr>
                    <td>{{ _("City") }}:</td>
                    <td>{{ curr_request.city }}</td>
                  </tr>
                  <tr>
                    <td>{{ _("Street") }}  </td>
                    <td> {{ curr_request.street }} </td>
                  </tr>
                </table>
              </td>
              <td>{{ curr_request.type }}</td>
              <td> {{curr_request.amount}} </td>
            </tr>
          {% endif %}
          {% endfor %}

        </table>

        <table class="table table-hover" id="request-history">
          <tr>
            <th colspan="3">Request history</th>
          </tr>
          <tr>
            <td>{{ _("Lp") }} </td>
            <td>{{ _("Name") }}</td>
            <td>{{ _("Status") }}</td>
            <td>{{ _("Affected") }}  </td>
            <td>{{ _("Address") }} </td>
            <td>{{ _("Needs") }}</td>
            <td>{{ _("Amount") }}</td>
          </tr>
          {% for curr_request in requests_for_charity_campaign %}
          {% if curr_request.status == request_status.COMPLETED %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ curr_request.name }}</td>
              <td>{{ curr_request.status }}</td>
              <td>
                <table class="table">
                  <tr>
                    <td>{{ _("First name:") }}</td>
                    <td>{{ curr_request.first_name }}</td>
                  </tr>
                  <tr>
                    <td>{{ _("Last name") }}  </td>
                    <td> {{ curr_request.last_name }} </td>
                  </tr>
                </table>
              </td>
              <td>
                <table>
                  <tr>
                    <td>{{ _("City") }}:</td>
                    <td>{{ curr_request.city }}</td>
                  </tr>
                  <tr>
                    <td>{{ _("Street") }}  </td>
                    <td> {{ curr_request.street }} </td>
                  </tr>
                </table>
              </td>
              <td>{{ curr_request.type }}</td>
              <td> {{curr_request.amount}} </td>
            </tr>
          {% endif %}
          {% endfor %}

        </table>


      {% endif %}

    <!-- <table>
      {% if curr_organizations is defined %}
        <tr>
          <td>Organization name:</td>
        </tr>
        {% for organization in curr_organizations %}
        <tr>
          <td>{{ organization.organization_name }}</td>
        </tr>
        {% endfor %}
      {% else %} 
        <tr>
          <th>{{ _("Could not find any organizations for selected charity campaign") }}</th>
        </tr>
      {% endif %}
    </table> -->

  
  
  </div>
</div>

{% endblock %}
